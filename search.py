import os,os.path
import sys
import requests
import re
import threading

def printAuth():
	print("""
                                                                                                                        
          @@@@@@@@@@@@                @@@@@@@@@@@@@@                @@@@@@@@@@@@@@@@                @@@@@@@@@@@@        
        @@@@@@@@  @@@@@@              @@@@@@  @@@@@@                @@@@      @@@@@@              @@@@@@  @@@@@@@@      
      @@@@@@@@        @@              @@@@@@    @@@@                @@      @@@@@@              @@@@@@      @@@@@@@@    
      @@@@@@          @@                @@@@@@    @@                      @@@@@@                @@@@          @@@@@@    
      @@@@@@                              @@@@@@@@                      @@@@@@@@                @@@@          @@@@@@    
      @@@@@@                                @@@@@@@@                    @@@@@@                  @@@@          @@@@@@    
      @@@@@@                          @@@@    @@@@@@                  @@@@@@                    @@@@          @@@@@@    
        @@@@@@        @@              @@@@      @@@@                @@@@@@        @@            @@@@@@      @@@@@@      
        @@@@@@@@@@@@@@@@              @@@@@@@@@@@@@@              @@@@@@@@      @@@@              @@@@@@@@@@@@@@        
            @@@@@@@@@@                @@@@@@@@@@@@@@              @@@@@@@@@@@@@@@@@@                @@@@@@@@@@          
                                                                                                        @@@@@@@@        
                                                                                                              @@@@      
                                                                                                                        """)
rfd = r"CVE.txt"
wfd = r"CVE-EXP.txt"
urlCVE = r"https://cve.mitre.org/cgi-bin/cvename.cgi?name="
patternEXP = r"EXPLOIT-DB"

mutexRead = threading.Lock()
mutexWrite = threading.Lock()
rfd = open(rfd,"r")
wfd = open(wfd,"w")

def searchThread():
	print("SearchThread Start");
	while 1:
		if mutexRead.acquire(10):
			cveNum = rfd.readline()
			mutexRead.release()
			if cveNum == "":
				print("SearchThread Exit");
				quit()
		
		req = requests.get(urlCVE + cveNum)
		res = re.search(patternEXP, req.text)
		if res != None:
			if mutexWrite.acquire(10):
				print("Find EXP:" + cveNum)
				wfd.write(cveNum);
				mutexWrite.release()
	
if __name__ == "__main__":
	printAuth()
	print("Start...")
	t = []
	
	for i in range(10):
		t.append(threading.Thread(target=searchThread, name='searchThread'))
		t[i].start()
	
	for i in range(10):
		t[i].join()
		
	print("Finish...")
	rfd.close()
	wfd.close()
